<!DOCTYPE html>
<html xmlns="">
<head>
    <meta charset="UTF-8">
    <title>Token</title>
    <!-- import CSS -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui@2.4.6/lib/theme-chalk/index.css">
    {{ JSGlue.include() }}
    <style>
        .el-select .el-input {
            width: 240px;
        }

        .input-with-select .el-input-group__prepend {
            background-color: #fff;
        }
    </style>
</head>
<body>
<div id="vue-app" style="width:1200px; margin:auto">

    <el-tabs type="border-card">
        <el-tab-pane label="Information Query">
            <el-row :gutter="20">
                <el-col :span="24">
                    <div style="margin-bottom: 15px;">
                        <el-input
                                placeholder="Please input TxHash"
                                type="string"
                                v-model="eventKey"
                                class="input-with-select">
                            <el-select v-model="eventInfoSelect" slot="prepend" placeholder="Select">
                                <el-option label="State" value="State"></el-option>
                                <el-option label="GasConsumed" value="GasConsumed"></el-option>
                                <el-option label="Notify" value="Notify"></el-option>
                            </el-select>
                            <el-button slot="append" icon="el-icon-search" @click="queryEvent"></el-button>
                        </el-input>
                    </div>
                </el-col>
            </el-row>

            <el-row :gutter="20">
                <el-col :span="8">
                    <div class="grid-content bg-purple">
                        <el-row>
                            <el-button type="primary" round @click="getName">Token Name</el-button>
                        </el-row>
                    </div>
                </el-col>
                <el-col :span="8">
                    <div class="grid-content bg-purple">
                        <el-row>
                            <el-button type="primary" round @click="getSymbol">Token Symbol</el-button>
                        </el-row>
                    </div>
                </el-col>
                <el-col :span="8">
                    <div class="grid-content bg-purple">
                        <el-row>
                            <el-button type="primary" round @click="getDecimal">Decimal</el-button>
                        </el-row>
                    </div>
                </el-col>
            </el-row>
        </el-tab-pane>

        <el-tab-pane label="Token Transfer">
            <el-row :gutter="20">
                <el-col :span="11">
                    <div class="grid-content bg-purple-light">
                        <el-row>
                            <el-input
                                    size="medium"
                                    type="string"
                                    placeholder="base58 encode address"
                                    suffix-icon="el-icon-location"
                                    v-model="inputTransferTo">
                                <template slot="prepend">to</template>
                            </el-input>
                        </el-row>
                    </div>
                </el-col>
                <el-col :span="10">
                    <div class="grid-content bg-purple">
                        <el-row>
                            <el-input
                                    size="medium"
                                    type="number"
                                    placeholder="the amount of oep4 token"
                                    suffix-icon="el-icon-caret-right"
                                    v-model="inputTransferAmount">
                                <template slot="prepend">amount</template>
                            </el-input>
                        </el-row>
                    </div>
                </el-col>
                <el-col :span="2">
                    <div class="grid-content bg-purple">
                        <el-row>
                            <el-button type="primary" round @click="transfer">transfer</el-button>
                        </el-row>
                    </div>
                </el-col>
            </el-row>
        </el-tab-pane>

        <el-tab-pane label="Token TransferMulti">
            TransferMulti
        </el-tab-pane>

        <el-tab-pane label="Token Approve">
            <el-row :gutter="20">
                <el-col :span="11">
                    <div class="grid-content bg-purple-light">
                        <el-row>
                            <el-input
                                    size="medium"
                                    type="string"
                                    placeholder="base58 encode address"
                                    suffix-icon="el-icon-location"
                                    v-model="inputTransferTo">
                                <template slot="prepend">spender</template>
                            </el-input>
                        </el-row>
                    </div>
                </el-col>
                <el-col :span="10">
                    <div class="grid-content bg-purple">
                        <el-row>
                            <el-input
                                    size="medium"
                                    type="number"
                                    placeholder="the amount of oep4 token"
                                    suffix-icon="el-icon-caret-right"
                                    v-model="inputTransferAmount">
                                <template slot="prepend">amount</template>
                            </el-input>
                        </el-row>
                    </div>
                </el-col>
                <el-col :span="2">
                    <div class="grid-content bg-purple">
                        <el-row>
                            <el-button type="primary" round @click="transfer">approve</el-button>
                        </el-row>
                    </div>
                </el-col>
            </el-row>
        </el-tab-pane>

        <el-tab-pane label="Token Allowance">
            Allowance
        </el-tab-pane>
        <el-tab-pane label="Token TransferFrom">
            TransferFrom
        </el-tab-pane>
        <el-tab-pane label="DApp Setting">
            Setting
        </el-tab-pane>
    </el-tabs>
</div>
</body>
<!-- import Vue before Element -->
<script src="https://unpkg.com/vue@2.5.17/dist/vue.js"></script>
<script src="https://unpkg.com/axios@0.18.0/dist/axios.min.js"></script>
<!-- import JavaScript -->
<script src="https://unpkg.com/element-ui@2.4.6/lib/index.js"></script>
<script>
    new Vue({
        el: '#vue-app',
        data: function () {
            return {
                visible: false,
                eventInfoSelect: "",
                eventKey: "",
                inputTransferTo: "",
                inputTransferAmount: ""
            }
        },
        methods: {
            queryEvent() {
                if (this.eventInfoSelect === "") {
                    this.$notify({
                        title: 'Query Event Error',
                        type: 'warning',
                        message: 'Please select an event information you want to query.',
                        duration: 800
                    })
                }
                else {
                    let self = this;
                    if (this.eventKey.length === 64) {
                        let url = Flask.url_for("get_smart_contract_event");
                        let self = this;
                        axios.post(url, {
                            tx_hash: self.eventKey,
                            event_info_select: self.eventInfoSelect
                        }).then(function (response) {
                            let result = response.data.result;
                            if (result.length === 0) {
                                self.$message({
                                    message: 'query failed!',
                                    type: 'error',
                                    duration: 800
                                })
                            }
                            else {
                                if (self.eventInfoSelect === 'Notify') {
                                    self.$alert(result, 'Query Result', {
                                        confirmButtonText: 'OK',
                                    })
                                } else {
                                    self.$notify({
                                        title: 'Query Result',
                                        type: 'succeed',
                                        message: result,
                                        duration: 0
                                    })
                                }
                            }
                        })
                    }
                    else if (this.eventKey.length === 0) {
                        self.$notify({
                            title: 'TxHash Error',
                            type: 'error',
                            message: 'Please input TxHash',
                            duration: 800
                        })
                    }
                }
            },
            getName() {
                let url = Flask.url_for("get_name");
                let self = this;
                axios.get(url).then(function (response) {
                    let tokenName = response.data.result;
                    self.$notify({
                        title: 'Token Name',
                        type: 'success',
                        message: tokenName,
                        duration: 0
                    });
                })
            },
            getSymbol() {
                let url = Flask.url_for("get_symbol");
                let self = this;
                axios.get(url).then(function (response) {
                    let tokenSymbol = response.data.result;
                    self.$notify({
                        title: 'Token Symbol',
                        type: 'success',
                        message: tokenSymbol,
                        duration: 0
                    })
                })
            },
            getDecimal() {
                let url = Flask.url_for("get_decimal");
                let self = this;
                axios.get(url).then(function (response) {
                    let tokenSymbol = response.data.result;
                    self.$notify({
                        title: "Token Decimal",
                        type: 'success',
                        message: tokenSymbol,
                        duration: 0
                    })
                })
            },
            transfer() {
                let url = Flask.url_for("transfer");
                let self = this;
                if (self.inputTransferTo.length === 34) {
                    if (self.inputTransferAmount > 0) {
                        self.$confirm('确认转账？', '提示', {
                            confirmButtonText: '确定',
                            cancelButtonText: '取消',
                            type: 'warning',
                            duration: 500
                        }).then(() => {
                                axios.post(url, {
                                    b58_to_address: self.inputTransferTo,
                                    amount: self.inputTransferAmount
                                }).then(function (response) {
                                    let tx_hash = response.data.result;
                                    if (tx_hash.length === 64) {
                                        self.$message({
                                            type: 'success',
                                            message: 'Transfer successfully： '.concat(tx_hash).concat('!'),
                                            duration: 1500
                                        });
                                    }
                                    else {
                                        self.$message({
                                            type: 'error',
                                            message: 'Transfer failed!',
                                            duration: 800
                                        });
                                    }
                                });
                            }
                        ).catch(() => {
                            self.$message({
                                message: '已取消转账',
                                type: 'warning',
                                duration: 800
                            });
                        });
                    }
                    else if (self.inputTransferAmount === 0) {
                        self.$notify({
                            title: "Amount Error",
                            type: 'warning',
                            message: "Please input the amount value great than 0.",
                            duration: 800
                        })
                    }
                    else {
                        self.$notify({
                            title: "Amount Error",
                            type: 'warning',
                            message: "Please input the correct amount value.",
                            duration: 800
                        })
                    }
                }
                else if (self.inputTransferTo.length === 0) {
                    self.$notify({
                        title: "Transfer Error",
                        type: 'error',
                        message: "Please input the address.",
                        duration: 500
                    })
                }
                else {
                    self.$notify({
                        title: "Transfer Error",
                        type: 'error',
                        message: "Please input the correct base58 encode address.",
                        duration: 500
                    })
                }
            },
            approve() {

                console.log('TODO');
            }
        }
    });
</script>
</html>